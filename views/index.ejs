<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/bootstrap.min.css' />
    <link rel='stylesheet' href='/stylesheets/bootstrap-responsive.min.css' />
    <link rel='stylesheet' href='/stylesheets/airshow.css' />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.lazyload.min.js"></script>
  </head>
  <body>
    <div class="container">
        <div class="page-header">
            <h1><%= title %></h1>
        </div>
        <% if (images.length > 0){ %>
          <ul class="thumbnails">
            <% images.forEach(function(image){ %>
              <li class="span2">
                <a href="<%= image.url %>" class="lightbox_trigger" data-width="<%= image.features.width %>" data-height="<%= image.features.height %>">
                  <img data-original="<%= image.previewurl %>" alt="<%= image.name%>" src="images/grey.gif" class="preview lazy">
                  <noscript><img src="<%= image.previewurl %>"></noscript>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } %>
        <div class="footer">
            Displayed by <a href="https://github.com/jmooserific/airshow">Airshow</a>
        </div>
        <div id="lightbox" style="display: none;">
            <div id="lightbox_content"></div>
        </div>
    </div>
    <script>
    function resizeLightbox() {
        if ($('#lightbox .front img') && $('#lightbox .front img').attr('data-width') && $('#lightbox .front img').attr('data-width') && $('#lightbox').is(':visible')) {
            var originalWidth = $('#lightbox .front img').attr('data-width');
            var originalHeight = $('#lightbox .front img').attr('data-height');
            
            var safeWidth = $(document).width() - 100;
            var safeHeight = $(document).height() - 100;

            var scaleWidth = originalWidth / safeWidth;
            var scaleHeight = originalHeight / safeHeight;
                        
            if (scaleWidth > scaleHeight) {
                $('.flip-container, .front, .back').width(originalWidth / scaleWidth);
                $('.flip-container, .front, .back').height(originalHeight / scaleWidth);
            } else {
                $('.flip-container, .front, .back').width(originalWidth / scaleHeight);
                $('.flip-container, .front, .back').height(originalHeight / scaleHeight);
            }
        }
    }
    
    $(window).resize(function() {
        resizeLightbox();
    });
    
    $(document).ready(function(){
        $("img.lazy").show().lazyload();
        
        $('.lightbox_trigger').click(function(e) {
        
            //prevent default action (hyperlink)
            e.preventDefault();
        
            //Get clicked link href
            var image_href = $(this).attr("href");
            var width = $(this).attr("data-width");
            var height = $(this).attr("data-height");
        
            //place href as img src value
            $('#lightbox_content').html('<div class="flip-container"><div class="flipper"><div class="front"><img src="' + image_href + '" data-width="' + width + '" data-height="' + height + '"></div><div class="back"><h1>The Back</h1></div></div></div>');
                        
            //show lightbox window - you could use .show('fast') for a transition
            $('#lightbox').fadeIn();
            
            resizeLightbox();
            
            $('#lightbox .front').click(function(event) {
                $('#lightbox .flipper').css( "-webkit-transform","rotateY(180deg)" );
                $('#lightbox .flipper').css( "-moz-transform","rotateY(180deg)" );
                $('#lightbox .flipper').css( "transform","rotateY(180deg)" );

                event.stopPropagation();
            });
            $('#lightbox .back').click(function(event) {
                $('#lightbox .flipper').css( "-webkit-transform","rotateY(0deg)" );
                $('#lightbox .flipper').css( "-moz-transform","rotateY(0deg)" );
                $('#lightbox .flipper').css( "transform","rotateY(0deg)" );
                
                event.stopPropagation();
            });
        });
        
        $('#lightbox').click(function() {
            $('#lightbox').fadeOut();
        });             
    });
    
    
    </script>
  </body>
</html>